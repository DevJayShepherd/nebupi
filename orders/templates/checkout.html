{% extends 'base.html' %}

{% load static %}

{% block title %}
  Checkout
{% endblock %}

{% block content %}
  <!-- HEADER -->
  <header class="bg-dark pt-9 pb-11 d-none d-md-block">
    <div class="container-md">
      <div class="row align-items-center">
        <div class="col">
          <!-- Heading -->
          <h1 class="fw-bold text-white mb-2">Checkout</h1>
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="pb-8 pb-md-11 mt-md-n6">
    <div class="container-md">
      <div class="row">
        <div class="col-12 col-sm-10 offset-sm-1 col-md-8 offset-md-2">
          <div class="card card-bleed shadow-light-lg mb-4">
            <!-- Card body -->
            <div class="p-5 text-center">
              <span class="badge bg-warning">Selected Plan</span>
              <div class="mb-5 mt-3">
                <h1 class="fw-bold">{{ plan.name }}</h1>
                <p class="mb-0">
                  Access all <span class="text-dark fw-medium">{{ plan.name }} content, features, and support.</span> Renewed monthly.
                </p>
              </div>
              <div class="d-flex justify-content-center">
                <span class="h3 mb-0 fw-bold text-primary">$</span>
                <div class="display-4 fw-bold text-primary">{{ plan.price|stringformat:'d' }}</div>
                <span class="align-self-end mb-1">/Monthly</span>
              </div>
            </div>
            <hr class="m-0" />
            <div class="p-5">
              <div id="paypal-button-container"></div>
            </div>
            <!-- hr -->
            <hr class="m-0" />
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- PayPal -->
  <script src="https://www.paypal.com/sdk/js?client-id={{ paypal_client_id }}&vault=true&intent=subscription" data-sdk-integration-source="button-factory"></script>
  <script>
    paypal
      .Buttons({
        style: {
          shape: 'rect',
          color: 'gold',
          layout: 'vertical',
          label: 'subscribe'
        },
        createSubscription: function (data, actions) {
          return actions.subscription.create({
            /* Creates the subscription */
            plan_id: '{{ plan.external_plan_id }}',
            custom_id: '{{ request.user.email }}'
          })
        },
        onApprove: function (data, actions) {
          console.log(data)
          window.location.href = "{% url 'thank_you' %}"
        }
      })
      .render('#paypal-button-container') // Renders the PayPal button
  </script>
  <!-- End Paypal -->
{% endblock %}
